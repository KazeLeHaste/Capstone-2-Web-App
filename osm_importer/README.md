# OSM Scenario Importer

This module handles importing OSM Web Wizard generated scenarios into the traffic simulator web application, preserving realistic traffic patterns while enabling configuration overlays.

## Recent Changes (Solution 1: Preserve Original Files)

**September 2025 Update**: The importer now prioritizes preserving original OSM Web Wizard files for realistic traffic simulation:

- **Prioritizes `.trips.xml` files** over `.rou.xml` files to maintain original timing patterns
- **Preserves realistic vehicle spawning/despawning** at edge roads as intended by OSM Web Wizard
- **Maintains proper traffic flow diversity** with realistic lane usage and vehicle variety
- **Route enhancement is optional** and warns about potential impact on realism
- **Better vehicle movement patterns** compared to processed/enhanced route files

## Directory Structure

```
osm_importer/
├── osm_scenario_importer.py     # Main importer script
├── osm_scenarios/               # Place OSM Web Wizard outputs here
│   ├── downtown_scenario/       # Example OSM scenario
│   │   ├── osm.net.xml         # Network file
│   │   ├── osm.sumocfg         # SUMO configuration
│   │   ├── osm.passenger.rou   # Passenger vehicle routes
│   │   ├── osm.bus.rou         # Bus routes
│   │   ├── osm.truck.rou       # Truck routes
│   │   └── ...                 # Other OSM files
│   └── suburb_scenario/         # Another scenario
├── README.md                    # This file
└── requirements.txt             # Python dependencies
```

## How to Use

### 1. Add OSM Scenarios

1. Generate a scenario using [OSM Web Wizard](https://sumo.dlr.de/docs/Tools/Import/OSM.html#osmwebwizardpy)
2. Download the complete scenario zip file
3. Extract the contents into `osm_scenarios/your_scenario_name/`

### 2. List Available Scenarios

```bash
cd osm_importer
python osm_scenario_importer.py --list
```

### 3. Import a Scenario

```bash
# Import with default name
python osm_scenario_importer.py --import downtown_scenario

# Import with custom name
python osm_scenario_importer.py --import downtown_scenario --name realistic_downtown
```

### 4. Use in Web Application

After importing, the scenario will be available in the web application's network selection page with:
- ✅ Realistic traffic patterns preserved
- ✅ All vehicle types (passenger, bus, truck, motorcycle)
- ✅ Proper timing and route distributions
- ✅ Configuration overlay support

## What Gets Imported

### Core Files
- **Network file** (`osm.net.xml`) → `network_name.net.xml`
- **Configuration** (`osm.sumocfg`) → `network_name.sumocfg`
- **Additional files** (views, edge data, etc.)

### Route Files (by vehicle type)
- **Passenger vehicles** (`osm.passenger.rou`)
- **Buses** (`osm.bus.rou`) 
- **Trucks** (`osm.truck.rou`)
- **Motorcycles** (`osm.motorcycle.rou`)
- **Trip files** (`*.trips`)

### Generated Metadata
- Network statistics (edges, junctions, lanes)
- Available vehicle types
- Import timestamp
- OSM scenario flag for web app recognition

## Integration with Web App

The imported scenarios integrate seamlessly with the existing web application workflow:

1. **Configuration First** - Users configure simulation parameters
2. **Network Selection** - OSM scenarios appear with special indicators
3. **Session Creation** - Files are safely copied to session directory
4. **Configuration Overlay** - Vehicle types, density, etc. applied
5. **Simulation Launch** - Realistic traffic simulation runs

## Configuration Overlays

The web application can modify OSM scenarios through:

- **Vehicle Type Selection** - Enable/disable vehicle categories
- **Traffic Density Scaling** - Multiply vehicle spawn rates
- **Simulation Duration** - Control simulation time
- **Time-of-Day** - Use different traffic patterns
- **Commercial Traffic** - Toggle truck/bus routes

## File Safety

- ✅ Original OSM files are never modified
- ✅ Each simulation uses session-specific copies
- ✅ Configuration changes only affect session copies
- ✅ Multiple users can use the same network safely

## Troubleshooting

### Scenario Not Recognized
- Ensure `osm.net.xml` and `osm.sumocfg` (or `osm`) files exist
- Check file permissions and accessibility
- Verify the scenario was generated by OSM Web Wizard

### Import Fails
- Check that target networks directory is writable
- Ensure sufficient disk space
- Verify XML files are not corrupted

### Missing Vehicle Types
- Some OSM scenarios may not include all vehicle types
- Check what `.rou` files are actually present
- Import will only include available vehicle types

## Examples

### Importing a City Center Scenario
```bash
# 1. Download from OSM Web Wizard
# 2. Extract to osm_scenarios/city_center/
# 3. Import with descriptive name
python osm_scenario_importer.py --import city_center --name realistic_city_center
```

### Batch Import Multiple Scenarios
```bash
# List all scenarios first
python osm_scenario_importer.py --list

# Import each one
python osm_scenario_importer.py --import scenario1 --name highway_junction
python osm_scenario_importer.py --import scenario2 --name residential_area
python osm_scenario_importer.py --import scenario3 --name commercial_district
```
